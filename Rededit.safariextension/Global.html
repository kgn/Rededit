<!DOCTYPE HTML>
<html>
	<head>
		<title>Rededit Global</title>
		<script type="text/javascript">
            function messageHandler(event){
                if(event.name === 'injectWithSettings'){
                    activeTab = event.target.browserWindow.activeTab;
                    if(activeTab.url.indexOf('reddit.com') >= 0){
                        if(safari.extension.settings.commentImages){               
                            activeTab.page.dispatchMessage('commentImages');
                        }
                        
                        if(safari.extension.settings.imageExpando){               
                            activeTab.page.dispatchMessage('imageExpando');
                        }
                        
                        if(safari.extension.settings.hideNoImageThumb){               
                            activeTab.page.dispatchMessage('hideNoImageThumb');
                        }
                        
                        if(safari.extension.settings.hideSelfThumb){               
                            activeTab.page.dispatchMessage('hideSelfThumb');
                        }
                    }
                }
            }
            
            safari.application.addEventListener('message', messageHandler, false);
          
            //TODO: add a timer to updat the extension bars,
            //because the bars currently only load when a webpage is loaded
        </script>
	</head>
</html>